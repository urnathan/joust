# NMS utils
# Copyright (C) 2022-2023 Nathan Sidwell, nathan@acm.org
# License: Affero GPL v3.0

include_directories (${CMAKE_CURRENT_BINARY_DIR})

# Compile all the source files here
file (GLOB TESTS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *.cc)
foreach (SRC ${TESTS})
  get_filename_component (STEM ${SRC} NAME_WLE)
  set (DEPS ${SRC})
  add_executable (${STEM} EXCLUDE_FROM_ALL ${DEPS})
  target_include_directories (${STEM} PRIVATE ${NMS_BINARY_DIR})
  if (NOT NMS_JOUSTING)
    target_include_directories (${STEM} PRIVATE ${NMS_INCLUDE_DIR})
  endif ()
  target_link_libraries (${STEM} nms "-L${JOUST_LIBRARY_DIR}" "joust")
  add_dependencies (check-nms ${STEM})
endforeach ()
